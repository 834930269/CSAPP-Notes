# 链接

## 链接

链接是将各种代码和数据片段收集并组合成为一个单一文件的过程。这个文件可被复制到内存中执行。

链接可以执行在：

- 编译时
- 加载时
- 运行时

链接使得分离编译成为可能，当我们改变模块中的某一个时，只需简单重新的编译它，并重新链接应用，而不必重新编译其他文件。

## 7.2 静态链接

链接器完成两个主要任务

1. 符号解析

   目标文件定义和引用符号，每个符号对应于一个函数、一个全局变量或一个静态变量。符号解析的目的是将每个符号引用正好和一个符号定义关联起来。

2. 重定位

   编译器和汇编器生成从地址0开始的代码和数据节。链接器通过把每个符号定义与一个内存位置关联起来，从而重定位这些节，然后修改这些符号的引用，使得它们指向这个内存位置。

一些链接器的基本事实：

1. 目标文件纯粹是字节块的集合。有些包含程序代码，有些保护程序数据，其他的则包含引导链接器和加载器的数据结构。

2. 链接器将这些块链接起来，确定被链接块的运行时位置，并且修改代码和数据块中的各种位置。
3. 链接器对目标机器的了解甚少。产生目标文件的编译器和汇编器已经完成了大部分工作。

​    

## 7.10 动态链接库

共享库是一个目标模块，在运行或加载时，可以加载到任意的内存地址，并和一个在内存中的程序链接起来。

在任何给定的文件系统中，对于一个库只有一个.so文件。所有引用该库的可执行目标文件共享这个.so文件中的代码和数据，而不是像静态库的内容那样被复制和嵌入到引用它们的可执行文件中。

-fpic选项指示编译器生成与位置无关的代码