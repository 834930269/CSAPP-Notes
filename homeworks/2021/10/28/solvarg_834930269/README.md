# Chapter.3 程序的机器级表示

--------------

## 3.7 过程

一个过程调用包括将数据(以过程参数和返回值形式)和控制代码从一部分传递到另一部分.  
另外,还需要在进入时为过程的局部变量分配空间,并在退出时释放这些空间  
数据传递、局部变量的分配和释放是通过操纵程序栈来实现的.

### 运行时栈

栈帧: x86-64的过程需要的存储空间超出寄存器能够存放的大小时,就会在栈上分配空间,这个部分成为过程的`栈帧`

当前执行的过程的帧总是在栈顶,当过程P调用过程Q时,会把返回地址压入栈中,指明当Q返回时,要从P程序的哪个位置继续执行。

大部分栈帧是定长的,在过程的开始就分配好了,但也有一些过程需要变长的帧。

但是,大部分的函数都`不需要栈帧`

### 控制转移

将控制从函数P转移到函数Q只需要简单的把程序计数器(PC)设置为Q的代码的起始位置。不过,当稍后从Q返回的时候,处理器必须记录好它需要`继续P执行的代码的位置`。

`call Q`实现这一功能,调用的时候会把地址`A`压入栈中,并将OC设置为Q的起始地址,压入的`A`被称为返回地址,`ret`会从栈中弹出地址A,并将PC设置为A

就是 call 进入一个函数,并记录进入前的地址, ret 会返回这个地址

### 数据传送

当调用一个过程时,除了要把地址压栈(过程),还可能包括返回一个值

当函数参数小于6个,直接放在寄存器上,但当函数参数大于6个,其余的则会放在栈上,至于多出的这部分放在栈上的参数,`也需要内存对齐`




--------------


> Latex转Svg

https://www.latexlive.com/