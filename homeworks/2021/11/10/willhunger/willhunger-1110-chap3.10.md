# Ch3 Machine-Level Representation of Programs

## 3.10 Combining Control and Data in Machine-Level Programs

**解决缓冲区溢出的方法**

2. 栈破坏检测
    * C 语言中，没有可靠的方法来防止对数组的越界写；但是能在发生越界写的情况下，造成有害结果之前，来进行检测；
    * GCC 会在产生的代码中加入栈保护者（stack protector）的机制，来检测缓冲区越界；
    * 在栈帧的任何局部缓冲区与栈状态之间存储一个特殊的 canary 值（或 guard value），在程序每次运行时产生的，攻击者没有简单的方法来预测这个值；在恢复寄存器状态和从函数返回之前，程序检查这个 canary 值是否被改变了，改变了则终止程序。
3. 限制可执行代码区域
    * 重新设计页的管理权限：可读、可写、可执行；
    * 对于某些栈区域，可以被设计为 可读、可写、不可执行来避免攻击者的恶意代码被执行，检查页是否执行由硬件来完成，效率上没有损失。