# Chapter.12 并发编程

pre.3

--------------

## 临界区 

前面一章讲到了不同线程间可能会因为指令穿插导致的错误运算

比如操作一个`cnt`的指令分为三条(Li,Ui,Si),这三条就被称作一个`临界区`  
这个临界区`不应该和其他临界区交替执行`,即需要**确保在统一进程的不同线程内临界区的执行是互斥的**

## 信号量

为了保证对临界区的访问是互斥的,`Edsger Dijkstra`提出了一种叫做`信号量`的特殊变量处理方法

PV操作:  

- P(s): 如果s非零,p将s减一,并且立即返回,如果s为0,那么就挂起这个线程,直到s非零,`等待V重启这个线程`,线程重启后,P将s减一,控制权返回给调用者  
- V(s): V操作将s加一。如果有任何线程阻塞在P操作等待s变成非0,那么V久会重启其中一个线程.s减一

P,V这两个操作分别在执行的时候是`不可中断,分割的`

P: `Proberen(荷兰语 测试)`  
V: `Verhogen(荷兰语 增加)`

原语操作的一个例子:  

```cpp
volatile long cnt = 0;
sem_t mutex;
Sem_init(&mutex,0,1);//初始化一个mutex(用于PV)

for(i=0;i<niters;++i){
    P(&mutex);
    cnt++;
    V(&mutex);
}
```


运行正确










--------------


> Latex转Svg

https://www.latexlive.com/