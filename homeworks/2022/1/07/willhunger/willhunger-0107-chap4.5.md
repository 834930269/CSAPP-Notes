# Ch4 Processor Architecture

## 4.5 Pipelined Y86-64 Implementations

**4.5.10 Unfinished Business**

* 多周期指令

    一个操作指令需要在多个周期的时间，例如整数乘法、浮点运算。有两种方法实现多周期指令：

    1. 扩展某些阶段的逻辑功能。会导致取指和译码阶段停止，性能损失大；
    2. 采用独立于流水线的特殊硬件完成某些复杂的操作，性能相对较好，但不同单元之间的操作需要同步，设计复杂。

* 与存储系统的接口

    PIPE 流水线设计中，假定访存能在一个时钟周期内完成读或写，忽略了代码的自我修改。

    但在实际中，我们操作的都是虚拟地址，需要讲虚拟地址翻译为物理地址，要访问的物理地址可能会位于磁盘上，在一个时钟周期内完成读写操作时不现实的。

    * 存储系统和处理器中间有 Cache 存储器，有两个 L1 cache，分别用于读指令和读写数据，还有一个 TLB 快表用于快速讲虚拟地址到物理地址。结合两个 Cache，大多数只能能在一个时钟周期内完成读写数据的操作。

    * 当 Cache 未命中时，需要访问内存，需要 3 ~ 20 个时钟周期，这期间，流水线会暂停，将指令保持在取指或访存阶段。

    * 当发生缺页中断时，需要处理器调用操作系统来处理缺页中断，处理完成好再回来重新执行导致缺页的指令，可能需要几百个时钟周期。

